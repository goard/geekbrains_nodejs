<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Messanger</title>
    <script
      src="https://cdn.socket.io/4.5.4/socket.io.min.js"
      integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <h1>Messanger</h1>
    <div id="connected"></div>
    <div id="userId"></div>
    <input type="text" id="input" autofocus />
    <input type="submit" id="send" value="Send" />
    <div id="app"></div>
  </body>
  <script type="text/javascript">
    const socket = io('localhost:3000')
    let userIdGlobal = null
    socket.on('connect', () =>
      console.log('Connection with localhost:3000 created ')
    )
    socket.on('connect-user', ({ userId }) => {
      userIdGlobal = userId

      document.getElementById('userId').innerHTML = `MyId: ${userId}`

      if (userIdGlobal !== userId) {
        document.getElementById('connected').innerHTML = `connect ${userId}`
      }
    })
    socket.on('server-msg', ({ userId, msg }) => {
      let userIdSpan = null
      let str
      if (userIdGlobal === userId) {
        userIdSpan = document.createElement('span').innerHTML = `Me: `
      } else {
        userIdSpan = document.createElement('span').innerHTML = `${userId}: `
      }
      const msgSpan = (document.createElement('span').innerHTML = msg)

      document.getElementById('app').append(userIdSpan)
      document.getElementById('app').append(msgSpan)
      document.getElementById('app').append(document.createElement('br'))
    })

    document.getElementById('send').onclick = function () {
      socket.emit('client-msg', {
        userId: userIdGlobal,
        msg: document.getElementById('input').value,
      })
      document.getElementById('input').value = ''
    }
  </script>
</html>
